# AMB Feedback Bot (Manual Installation)

Репозиторий для облегчения ручной установки [бота обратной связи AMB](https://github.com/amb-code/amb-feedback-bot). Бот обратной связи представляет из себя тг-бота и тг-группой с темами, связанных друг с другом. В тг-бота пользователи пишут сообщения, а админы/редакция через тг-группу отвечают им. На каждого написавшего в тг-бота бот создает в тг-группе отдельную тему, в которой будет диалог только с этим человеком. Инструкция по запуску бота обратной связи. С инструкцией справится любой пользователь, никакие специфические навыки не требуются. Внимательно читайте и делайте по порядку

## А) Предварительная подготовка:

0. У вас есть компьютер/ноутбук с Windows

1. У какого-нибудь хостинга арендовать виртуальный сервер (VPS) с Ubuntu-22.04 или Ubuntu-24.04. VPS нужен для того, чтобы бот работал 24 часа в сутки. Шаги:
— выбрать хостинг
— регистрация на сайте хостинга
— выбрать сервер у хостинга (подойдет самый дешевый)
— оплатить сервер
— получить от хостинга 3 поля вашего арендованного сервера для подключения к нему (обычно после оплаты автоматически приходит информация на почту или в личный кабинет хостинга). Поля: server_ip, ssh_login (обычно это root или administranor) и ssh_password

2. Скачать и установить программу WinSCP для обмена файлами с сервером отсюда:
https://winscp.net/eng/download.php

3. Скачать и установить программу Putty для доступа к командной строке сервера отсюда:
https://www.putty.org

4. Создать тг-бота у https://t.me/BotFather . Пользователи будут отправлять в созданного тг-бота сообщения для вас. При создании BotFather пришлет «токен» (это строка из символов), сохраните его

5. Создать тг-группу. Группа — это «коллцентр», в который тг-бот будет пересылать сообщения пользователей и через который вы будете отправлять им ответы. Нужно узнать и сохранить ID созданной группы с помощью шагов:
— включите в группе «темы»/«топики» (Управление групой -> Темы -> Включить темы)
— выдайте себе возможноть отправлять сообщения от имени группы (Управление группой -> Администраторы -> Правой кнопкой на себя -> Изменить права -> Анонимность ВКЛ)
— напишите любое сообщение в топик «#General» от имени группы 
— перешлите свое сообщение от имени группы в бот https://t.me/TheGetAnyID_bot , он пришлет ID группы (это отрицательное число с 10-15 знаками), сохраните ID группы

6. Добавить тг-бота в тг-группу и сделать бота админом с такими возможностями «управлять темами» и «закреплять сообщения» (управление группой -> администраторы -> правой кнопкой на бота -> изменить права)

## Б) Настройка сервера:

0. Вы сделали все пункты из предворительной подготовки. У вас есть 5 полей:
— server_ip
— ssh_login
— ssh_password
— token бота
— id группы коллцентра

1. Подключиться к арендованному серверу через программу Putty с помощью шагов:
— Запустите PuTTY
— Ведите IP-адрес сервера: server_ip
— Проверьте, что «Port» указан 22
— Проверьте, что «Connection type» выбран SSH.
— Нажмите кнопку «Open»
— При первом подключении появится окно про ключ шифрования, нажмите «Accept»
— Откроется окно терминала с предложением ввести логин: login as: введите ssh_login и нажмите клавишу «Enter».
— Даллее запросит password: введите пароль ssh_password. Пароль можно вводить не посимвольно руками, а скопировать, в активном окне терминала нажать правую кнопку мыши — он вставится в терминал. Введённые/Вставленные символы не отображаются, после окончания ввода нажмите клавишу «Enter».
— Если логин и пароль введены верно, то вход на сервер будет успешным, а в консоли появится приветственное сообщение и приглашение на ввод команд

3. Далее все команды пишутся последовательно в терминале сервера через PuTTY (каждая следующая команда отправляется только после выполнения сервером предыдущей):
— установить docker: curl https://get.docker.com | sh
— выдаем права: useradd -m -g docker docker
— переходим в папку: cd /home/docker
— скачиваем код на сервер: git clone https://github.com/amb-code/amb-feedback-bot-minst.git amb-feedback-bot
— выдаем права: chown -R 1000:100 /home/docker/amb-feedback-bot
— можно закрывать putty

4. Чтобы бот работал, в его параметры нужно записать токен вашего тг-бота и ID группы-коллцентра и отправить параметры на сервер с помощью шагов: 
— скачать файл bot.env отсюда: https://github.com/amb-code/amb-feedback-bot-minst/blob/main/env/bot.env (там есть кнопка «Download raw file» со стрелочкой на ее иконке)
— открыть его в любом тектовом редакторе (Notepad++, Блокнот, WordPad, MicrosoftWord и др)
— в поле «TG_TOKEN=» вместо <токен бота> записать токен вашего тг бота
— в поле «TG_CHAT_ID=» вместо <id канала> записать ID вашей группы (с минусом).
— сохранить изменения в файле bot.env (проверьте, что файл также называется bot и имеет расширение .env)
— подключиться к серверу через программу winSCP (при подключении проверить протокол передачи: SFTP, Порт : 22, Имя хоста:  server_ip, Имя пользователя: ssh_login, Пароль: ssh_password)
— при успешном подключении откроетсе окно, в левой части будут директории вашего компьютера, в правой - директории удаленного сервера.
— в левой части нужно перейти в папку, где хранится новая исправленная вами версия bot.env . В правой части нужно перейти в папку на сервере /home/docker/amb-feedback-bot/env/ , где хранится старая версия файла bot.env 
— перетащить отредактированный файл bot.env из левой части окна в правую, согласиться на перезапись этого файла на сервере
— закрыть winSCP

## В) Запуск и перезапуск бота

0. Ранее вы сделали все пункты из А) Предварительной подготовки и Б) Настройки сервера

1. Подключиться к серверу через программу PuTTY

2. Перейти в папку командой: cd /home/docker/amb-feedback-bot

 3*. (Пропустить этот пункт при первом запуске бота) Если ранее бот был запущен и вы хотите перезапустить, то предварительно введите команду для его выключения: docker compose down

4. Введите команду для запуска: docker compose up -d

5. Бот уже запущен. Проверить логи бота, чтобы в них не было никаких ошибок и была надпись «listening», командой: docker compose logs feedback-bot

6. Можно закрыть PuTTY

7. Протестировать работу всех функции через тг-бота и тг-группу
